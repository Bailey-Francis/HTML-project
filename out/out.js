(()=>{var O=Object.defineProperty,R=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var X=(l,e,i)=>e in l?O(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i,Y=(l,e)=>{for(var i in e||={})D.call(e,i)&&X(l,i,e[i]);if(E)for(var i of E(e))N.call(e,i)&&X(l,i,e[i]);return l},S=(l,e)=>R(l,V(e));var w={};document.addEventListener("keydown",l=>{let e=l.key.toLowerCase();w[e]||(w[e]=1)});document.addEventListener("keyup",l=>{w[l.key.toLowerCase()]=void 0});function z(){Object.keys(w).forEach(l=>w[l]+=1)}function y(l){return w[l]?1:0}function F(l){return w[l]==1}function B(){return y("w")}function P(){return y("a")}function L(){return y("s")}function C(){return y("d")}function I(){return F("shift")}var a=class{constructor(e,i){this.x=e;this.y=i}addVec(e){return new a(this.x+e.x,this.y+e.y)}addConst(e){return new a(this.x+e,this.y+e)}scale(e){return new a(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x**2+this.y**2)}normalize(){let e=this.magnitude();return new a(this.x/e,this.y/e)}calcTile(e){}};var v=class{constructor(){this.size=60;this.accel=1.7;this.friction=.83;this.dashSpeed=20}initializePlayer(){this.id=0,this.velocity=new a(0,0),this.position=new a(150,150),this.img=new Image(60),this.img.src="./img/DemonPlayer.png"}updatePlayer(){this.movePlayer()}movePlayer(){let e=new a(C()-P(),L()-B()).scale(this.accel);this.velocity=this.velocity.addVec(e),x.onTiles(this.position).forEach(o=>this.velocity=this.velocity.scale(o.frictionmod)),I()&&(this.velocity=this.velocity.normalize().scale(this.dashSpeed)),this.position=this.position.addVec(this.velocity),p.moveHitbox(this.id,this.velocity).collidedAny&&console.log("1")}drawPlayer(){b.drawImage(this.img,this.position.x,this.position.y)}};var k=class{constructor(e,i,o,n,s,u){this.position=e;this.width=i;this.height=o;this.src=n;this.frictionmod=s;this.collide=u}drawTile(){b.drawImage(this.src,this.position.x*this.width,this.position.y*this.height)}};var f=class{constructor(e,i,o,n){this.id=e;this.src=i;this.frictionmod=o;this.collide=n}},g={};g.w=new f("water","./img/waterTile.png",.85,!1);g.g=new f("grass","./img/grassTile.png",.93,!1);g.g1=new f("grass","./img/grassTile1.png",.93,!1);g.b=new f("water","./img/waterTile.png",.85,!0);var M=class{constructor(e,i){this.tiles=e;this.width=i}constructMap(e){let i=[];for(let o=0;o<e.length;o++)i[o]=this.genTile(e[o],o);return i}genTile(e,i){let o=g[e],n=new Image(128);return n.src=o.src,new k(new a(i%this.width,Math.floor(i/this.width)),T,T,n,o.frictionmod,o.collide)}onTiles(e){let i=[];return i.push(this.tiles[Math.floor(e.y/128)*this.width+Math.floor(e.x/128)]),i.push(this.tiles[Math.floor(e.y/128)*this.width+Math.floor((e.x+60)/128)]),i.push(this.tiles[Math.floor((e.y+60)/128)*this.width+Math.floor((e.x+60)/128)]),i.push(this.tiles[Math.floor((e.y+60)/128)*this.width+Math.floor(e.x/128)]),i}drawMap(){this.tiles.forEach(e=>{e.drawTile()})}};var H=class{constructor(){this.hitboxes={};this.axisX=[];this.axisY=[]}addHitbox(e){let i=S(Y({},e),{collideX:new Set,collideY:new Set});this.hitboxes[i.id]=i;let o=this.addToAxis(this.axisX,e.x,e.x+e.w,e.id),n=this.addToAxis(this.axisY,e.y,e.y+e.h,e.id),s=Array.from(o),u=Array.from(n),c=s.filter(r=>u.includes(r)),d={id:e.id,collideX:s,collideY:u,collided:c,collidedAny:c.length>0};return i.collideX=new Set(s),i.collideY=new Set(u),i.collideX.forEach(r=>{this.hitboxes[r].collideX.add(e.id)}),i.collideY.forEach(r=>{this.hitboxes[r].collideY.add(e.id)}),d}addToAxis(e,i,o,n){let s={id:n,marker:"low",value:i},u={id:n,marker:"high",value:o},c=!1,d=!1,r=new Set,t=new Set;for(let h=0;h<e.length;h++){if(!c&&e[h].value>i){c=!0,t=new Set(r),e.splice(h,0,s);continue}if(c&&e[h].value>o){e.splice(h,0,u),d=!0;break}e[h].marker==="low"?r.add(e[h].id):r.delete(e[h].id),c&&e[h].marker==="low"&&t.add(e[h].id)}return c||e.push(s),d||e.push(u),t}moveHitbox(e,i){let o=this.moveOnAxis(this.axisX,e,i.x),n=this.moveOnAxis(this.axisY,e,i.y);for(let r=0;r<o[0].length;r++)this.hitboxes[e].collideX.add(o[0][r]);for(let r=0;r<n[0].length;r++)this.hitboxes[e].collideY.add(n[0][r]);for(let r=0;r<o[1].length;r++)this.hitboxes[e].collideX.delete(o[1][r]);for(let r=0;r<n[1].length;r++)this.hitboxes[e].collideY.delete(n[1][r]);this.hitboxes[e].x+=i.x,this.hitboxes[e].y+=i.y;let s=Array.from(this.hitboxes[e].collideX),u=Array.from(this.hitboxes[e].collideY),c=s.filter(r=>u.includes(r));return{id:e,collideX:s,collideY:u,collided:c,collidedAny:c.length>0}}moveOnAxis(e,i,o){let n="high",s="low",u=[],c=[];o>0&&(n="high",s="low"),o<0&&(n="low",s="high");let d=e.filter(t=>t.id==i&&t.marker==n)[0],r=e.filter(t=>t.id==i&&t.marker==s)[0];return n=="high"&&(e.filter(t=>t.marker==s&&t.value>=d.value&&t.value<=d.value+o).forEach(t=>u.push(t.id)),e.filter(t=>t.marker==n&&t.value>=r.value&&t.value<=r.value+o).forEach(t=>c.push(t.id))),n=="low"&&(e.filter(t=>t.marker==s&&t.value<=d.value&&t.value>=d.value+o).forEach(t=>u.push(t.id)),e.filter(t=>t.marker==n&&t.value<=r.value&&t.value>=r.value+o).forEach(t=>c.push(t.id))),e.filter(t=>t.id==i).forEach(t=>{t.value+=o}),[u,c]}drawHitbox(e){b.strokeStyle="black",b.strokeRect(this.hitboxes[e].x,this.hitboxes[e].y,this.hitboxes[e].w,this.hitboxes[e].h)}};var _=["b","b","g","g","b","b","b","b","g","g","g","g","b","b","b","g","g1","g","g","b","b","b","g","g","g","g","b","b","b","b","b","b","b","b","b","b","w","g","g","g","w","b","b","w","g","w","g","w","b","b","w","g","g","g","w","b","b","w","g","g","g","w","b","b","w","g","g","g","w","b","b","w","g","g","g","w","b","b","w","w","w","w","w","b","b","b","b","b","b","b","b"],A=document.getElementById("canvas"),b=A.getContext("2d");b.canvas.width=window.innerWidth-18;b.canvas.height=window.innerHeight-18;var T=128,x=new M([],7);x.tiles=x.constructMap(_);var m=new v;m.initializePlayer();var p=new H;p.addHitbox({id:m.id,x:m.position.x,y:m.position.y,w:m.size,h:m.size});p.addHitbox({id:1,x:400,y:400,w:100,h:100});p.addHitbox({id:2,x:300,y:300,w:110,h:110});function j(){m.updatePlayer(),z(),q()}function q(){b.clearRect(0,0,A.width,A.height),x.drawMap(),m.drawPlayer(),p.drawHitbox(m.id),p.drawHitbox(1),p.drawHitbox(2)}window.onresize=function(){location.reload()};setInterval(j,18);})();
